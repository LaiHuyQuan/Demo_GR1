<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ApexCharts Example</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  </head>
  <body>
    <div id="c2" style="width: 100%; height: 400px"></div>
    <script>
      var lineChart = {};

      const renderRTLineChart = ({
        data = [],
        name = "",
        type = "I",
        color = [],
        stack = false,
        id = "c2",
      } = {}) => {
        let anoArr = [];
        if (data[0] && data[0]["data"].length > 0) {
          for (let i = 0; i < data.length; i++) {
            if (data[i]["data"].length > 0) {
              anoArr[i] = {
                x: new Date(
                  data[i]["data"][data[i]["data"].length - 1]["x"]
                ).getTime(),
                y: data[i]["data"][data[i]["data"].length - 1]["y"],
                marker: {
                  size: 6,
                  strokeColor: color[i],
                },
                label: {
                  offsetX: -20,
                  borderColor: color[i],
                  style: {
                    color: "#fff",
                    background: color[i],
                  },
                  text:
                    data[i]["data"][data[i]["data"].length - 1]["y"].toFixed(
                      1
                    ) +
                    " " +
                    type,
                },
              };
              if (stack && i > 0) {
                anoArr[i]["y"] += anoArr[i - 1]["y"];
              }
            }
          }
        }

        let optionsLine = {
          annotations: {
            points: anoArr,
          },
          colors: color,
          series: data,
          theme: {
            mode: "dark",
          },
          noData: {
            text: "No Data",
          },
          stroke: { width: 2.5, curve: "smooth" },
          chart: {
            id: id,
            stacked: stack,
            animations: {
              enabled: false,
            },
            type: "line",
            background: "transparent",
            height: document.getElementById(id).offsetHeight - 15,
            toolbar: {
              show: false,
            },
            zoom: {
              enabled: false,
            },
          },
          yaxis: {
            decimalsInFloat: 1,
          },
          xaxis: {
            type: "datetime",
            labels: {
              datetimeUTC: false,
              datetimeFormatter: {
                year: "yyyy",
                month: "MM/yy",
                day: "dd/MM",
                hour: "HH:mm",
              },
            },
          },
          dataLabels: {
            enabled: false,
          },
          grid: {
            borderColor: "#555",
          },
          tooltip: {
            shared: true,
            intersect: false,
            x: {
              format: "dd/MM HH:mm",
            },
            y: {},
          },
        };

        if (type === "I") {
          optionsLine.yaxis.labels = {
            formatter: function (value) {
              return value.toFixed(1) + " A";
            },
          };
          optionsLine.tooltip.y = {
            formatter: function (value) {
              return value.toFixed(1) + " A";
            },
          };
        } else if (type === "P") {
          optionsLine.yaxis.labels = {
            formatter: function (value) {
              if (value < 1000) {
                return value.toFixed(1) + " W";
              } else {
                return (value / 1000).toFixed(1) + " kW";
              }
            },
          };
          optionsLine.tooltip.y = {
            formatter: function (value) {
              if (value < 1000) {
                return value.toFixed(1) + " W";
              } else {
                return (value / 1000).toFixed(1) + " kW";
              }
            },
          };
        }

        if (!lineChart[id]) {
          lineChart[id] = new ApexCharts(
            document.querySelector("#" + id),
            optionsLine
          );
          lineChart[id].render();
        } else {
          ApexCharts.exec(id, "updateOptions", { ...optionsLine }, false, true);
        }
      };

      const chartData = {
        curr: [
          {
            data: [
              { x: "2024-05-10T14:50:30Z", y: 3825.2372656 },
              { x: "2024-05-10T14:51:00Z", y: 3454.1445402500003 },
              { x: "2024-05-10T14:51:30Z", y: 3576.1801191000004 },
              { x: "2024-05-10T14:52:00Z", y: 3397.2392729000003 },
              { x: "2024-05-10T14:52:30Z", y: 3501.2171782 },
              { x: "2024-05-10T14:53:00Z", y: 3344.8050205 },
              { x: "2024-05-10T14:53:30Z", y: 3576.5529839 },
              { x: "2024-05-10T14:54:00Z", y: 3491.3450412499997 },
              { x: "2024-05-10T14:54:30Z", y: 3695.7710083 },
              { x: "2024-05-10T14:55:00Z", y: 3636.4302046000003 },
              { x: "2024-05-10T14:55:30Z", y: 3775.3430710499997 },
              { x: "2024-05-10T14:56:00Z", y: 3767.7265049000002 },
              { x: "2024-05-10T14:56:30Z", y: 3761.3033275999996 },
              { x: "2024-05-10T14:57:00Z", y: 3618.66115115 },
              { x: "2024-05-10T14:57:30Z", y: 3647.5383057 },
              { x: "2024-05-10T14:58:00Z", y: 3581.438083 },
              { x: "2024-05-10T14:58:30Z", y: 3565.36643775 },
              { x: "2024-05-10T14:59:00Z", y: 3621.0882573 },
              { x: "2024-05-10T14:59:30Z", y: 2365.2599053 },
              { x: "2024-05-10T15:00:00Z", y: 3722.4680258999997 },
              { x: "2024-05-10T15:00:30Z", y: 3700.0485986 },
              { x: "2024-05-10T15:01:00Z", y: 3807.1344919499998 },
              { x: "2024-05-10T15:01:30Z", y: 3848.5428545 },
              { x: "2024-05-10T15:02:00Z", y: 3775.3539995 },
              { x: "2024-05-10T15:02:30Z", y: 3601.996271 },
              { x: "2024-05-10T15:03:00Z", y: 3491.5375371 },
              { x: "2024-05-10T15:03:30Z", y: 3594.2107349 },
              { x: "2024-05-10T15:04:00Z", y: 3611.8522036 },
              { x: "2024-05-10T15:04:30Z", y: 1616.425 },
              { x: "2024-05-10T15:05:00Z", y: 0.0 },
              { x: "2024-05-10T15:05:30Z", y: 0.0 },
            ],
            name: "Pha A",
          },
          {
            data: [
              { x: "2024-05-10T14:50:30Z", y: 3813.6812544 },
              { x: "2024-05-10T14:51:00Z", y: 3436.69226025 },
              { x: "2024-05-10T14:51:30Z", y: 3560.0624048 },
              { x: "2024-05-10T14:52:00Z", y: 3387.8391703999996 },
              { x: "2024-05-10T14:52:30Z", y: 3491.86638525 },
              { x: "2024-05-10T14:53:00Z", y: 3329.3795107 },
              { x: "2024-05-10T14:53:30Z", y: 3568.4144140999997 },
              { x: "2024-05-10T14:54:00Z", y: 3483.8859622 },
              { x: "2024-05-10T14:54:30Z", y: 3683.8119877999998 },
              { x: "2024-05-10T14:55:00Z", y: 3619.8105464 },
              { x: "2024-05-10T14:55:30Z", y: 3763.2694186999997 },
              { x: "2024-05-10T14:56:00Z", y: 3765.8175459000004 },
              { x: "2024-05-10T14:56:30Z", y: 3748.6156367 },
              { x: "2024-05-10T14:57:00Z", y: 3604.9298623 },
              { x: "2024-05-10T14:57:30Z", y: 3643.1903804000003 },
              { x: "2024-05-10T14:58:00Z", y: 3577.5694980000003 },
              { x: "2024-05-10T14:58:30Z", y: 3557.1477087499998 },
              { x: "2024-05-10T14:59:00Z", y: 3613.0091216 },
              { x: "2024-05-10T14:59:30Z", y: 2295.1624653 },
              { x: "2024-05-10T15:00:00Z", y: 3712.2227534000003 },
              { x: "2024-05-10T15:00:30Z", y: 3683.4328066 },
              { x: "2024-05-10T15:01:00Z", y: 3791.7471293999997 },
              { x: "2024-05-10T15:01:30Z", y: 3840.986251 },
              { x: "2024-05-10T15:02:00Z", y: 3757.9866606 },
              { x: "2024-05-10T15:02:30Z", y: 3585.90690235 },
              { x: "2024-05-10T15:03:00Z", y: 3487.7154770999996 },
              { x: "2024-05-10T15:03:30Z", y: 3587.7489536000003 },
              { x: "2024-05-10T15:04:00Z", y: 3595.5526443 },
              { x: "2024-05-10T15:04:30Z", y: 1534.121 },
              { x: "2024-05-10T15:05:00Z", y: 0.0 },
              { x: "2024-05-10T15:05:30Z", y: 0.0 },
            ],
            name: "Pha B",
          },
          {
            data: [
              { x: "2024-05-10T14:50:30Z", y: 3857.2784858 },
              { x: "2024-05-10T14:51:00Z", y: 3476.461845 },
              { x: "2024-05-10T14:51:30Z", y: 3601.7321494 },
              { x: "2024-05-10T14:52:00Z", y: 3423.876502 },
              { x: "2024-05-10T14:52:30Z", y: 3527.90157835 },
              { x: "2024-05-10T14:53:00Z", y: 3369.5221352999997 },
              { x: "2024-05-10T14:53:30Z", y: 3616.7441914 },
              { x: "2024-05-10T14:54:00Z", y: 3532.38726805 },
              { x: "2024-05-10T14:54:30Z", y: 3736.5286919 },
              { x: "2024-05-10T14:55:00Z", y: 3679.1383809 },
              { x: "2024-05-10T14:55:30Z", y: 3819.19292945 },
              { x: "2024-05-10T14:56:00Z", y: 3808.8957450999997 },
              { x: "2024-05-10T14:56:30Z", y: 3793.4579609 },
              { x: "2024-05-10T14:57:00Z", y: 3647.1162776 },
              { x: "2024-05-10T14:57:30Z", y: 3678.1521265 },
              { x: "2024-05-10T14:58:00Z", y: 3615.0589004 },
              { x: "2024-05-10T14:58:30Z", y: 3589.2975916 },
              { x: "2024-05-10T14:59:00Z", y: 3645.1897231 },
              { x: "2024-05-10T14:59:30Z", y: 2381.5353022 },
              { x: "2024-05-10T15:00:00Z", y: 3751.0245332 },
              { x: "2024-05-10T15:00:30Z", y: 3724.3348735 },
              { x: "2024-05-10T15:01:00Z", y: 3839.32422975 },
              { x: "2024-05-10T15:01:30Z", y: 3884.7524355 },
              { x: "2024-05-10T15:02:00Z", y: 3810.1231504 },
              { x: "2024-05-10T15:02:30Z", y: 3626.74765575 },
              { x: "2024-05-10T15:03:00Z", y: 3521.6216113 },
              { x: "2024-05-10T15:03:30Z", y: 3629.9004873000003 },
              { x: "2024-05-10T15:04:00Z", y: 3640.7138811000004 },
              { x: "2024-05-10T15:04:30Z", y: 1599.96 },
              { x: "2024-05-10T15:05:00Z", y: 0.0 },
              { x: "2024-05-10T15:05:30Z", y: 0.0 },
            ],
            name: "Pha C",
          },
        ],
      };
      const phaseColor = ["#FF5733", "#33FF57"];

      renderRTLineChart({
        data: chartData.curr,
        name: "curr",
        type: "I",
        color: phaseColor,
        stack: false,
        id: "c2",
      });
    </script>
  </body>
</html>
